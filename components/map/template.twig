{% from "@components/modal/macro.twig" import sbModal %}
{% from "@components/prose/macro.twig" import sbProse %}

<div
    data-module="sb-map"
    class="sb-map {%- if params.classes %} {{ params.classes }}{% endif %}"
    {%- for attribute, value in params.attributes %} {{ attribute }}="{{ value }}"{% endfor %}>
    <div class="sb-map__map-container">
        <div class="sb-map__map" id="{{ params.id }}"></div>
    </div>
    <ol class="sb-map__list">
    	{%- for loc in params.points %}
    		<li
                class="sb-map__list-item"
                itemprop="location"
                itemscope itemtype="http://schema.org/Place">
                <h3 class="sb-map__list-name" itemprop="name">{{ loc.name }}</h3>
    			<div
                    class="sb-map__list-address"
                    itemprop="address">
                    {{ loc.address | split(',') | join('<br>') }}
                </div>
    			{%- if loc.travel_info or loc.accessibility_info %}
                    {% set modalId = 'Location-' ~ loop.index ~ '-Details' %}
        			<button type="button" class="sb-map__list-more" data-micromodal-trigger="{{ modalId }}">
                        <span aria-hidden="true">More info</span>
                        <span class="sb-!-sr">Travel and accessibility information for {{ loc.name }}</span>
                    </button>
                    {% set modalContent %}
                        {% set modalDetailsInner %}
                            <p>{{ loc.address | split(',') | join('<br>') }}</p>
                            <ul class="sb-list">
                                <li><a class="sb-link-no-visited" href="https://www.google.com/maps/place/{{ loc.latitude }},{{ loc.longitude }}" rel="noindex noreferrer noopener" target="_blank">View on Google Maps</a></li>
                                <li><a class="sb-link-no-visited" href="http://maps.apple.com/?ll={{ loc.latitude }},{{ loc.longitude }}&q={{ loc.name }}" rel="noindex noreferrer noopener" target="_blank">View on Apple Maps</a></li>
                            </ul>
                            {%- if loc.travel_info %}
                                <hr class="sb-rule sb-rule--visible sb-rule--l">
                                <h3 class="sb-heading-s">Travelling to {{ loc.name }}</h3>
                                {{ loc.travel_info }}
                            {%- endif %}
                            {%- if loc.accessibility_info %}
                                <hr class="sb-rule sb-rule--visible sb-rule--l">
                                <h3 class="sb-heading-s">Accessibility at {{ loc.name }}</h3>
                                {{ loc.accessibility_info }}
                            {%- endif %}
                        {% endset %}
                        {{ sbProse({
                            html: modalDetailsInner
                        }) }}
                    {% endset %}
                    {{ sbModal({
                        id: modalId,
                        heading: 'Travel and accessibility information for ' ~ loc.name,
                        html: modalContent
                    }) }}
    			{%- endif %}
    		</li>
    	{%- endfor %}
    </ol>
</div>

<script>
	window.addEventListener('DOMContentLoaded', function() {
		var map = new window.sb.Map(
			document.querySelector('[data-module="sb-map"]'),
			GOOGLE_MAPS_API_KEY,
			function() {
				map.addMultipleLocations({{ params.points | json_encode }});
			}
		);
	});
</script>